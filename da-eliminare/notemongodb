//gestione mongodb
var Db = require('mongodb').Db,
    Connection = require('mongodb').Connection,
    Server = require('mongodb').Server;

var host = process.env['MONGO_NODE_DRIVER_HOST'] != null ? process.env['MONGO_NODE_DRIVER_HOST'] : 'localhost';
var port = process.env['MONGO_NODE_DRIVER_PORT'] != null ? process.env['MONGO_NODE_DRIVER_PORT'] : '27017';


//poolSize => numero di connessioni
//w:1 -> attende la conferma di scrittura per fare callback
var db = new Db("Bikeaway", new Server("localhost","27017", {auto_reconnect: true, poolSize: 20}),{w: 1});



db.collection("albums", function(err, albums){
    if (err) {
        console.log("collection "+ err);
        return;
    }

    console.log("ecco: " + albums.toString());

    var album = { _id: "ciao",
                  nome: "matteo",
                  cognome: "ziviani"}

    albums.insert(album, {safe:true}, function(err, inserted_doc) {
        if (err) {
          console.log("Errore di insert: " + err)
          return;
        }

        console.log("dopo insert:" + inserted_doc);

    })
})
